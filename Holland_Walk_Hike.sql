/* Change where clause to: row_number = 1 and segment = 'Bike' to get users that ONLY did the bike part */

SELECT * FROM (
SELECT *, ROW_NUMBER() OVER (PARTITION BY user_id order by segment DESC) FROM (
SELECT user_id, login__ifit__email, segment, count(*) as "workouts"
fROM (
select user_id, login__ifit__email, personal__firstname, personal__lastname, start_minute, programs_id, duration,
        (duration/1000) as Duration_Secs,
        round((duration/1000) / w.target_value, 2) as percent_complete,
        CASE WHEN workout_id IN ('5e5447825c38e00008aae76f',
'5e55821ab42d120008a51c60',
'5e54375c5c38e00008aae71b',
'5e5457ef4c11ae00071ba70f',
'5e5442835c38e00008aae754',
'5e66847edaeab30009c04c09',
'5e589160ec549300080edb8d',
'5e61429d6562f70008f5e756',
'5e78e11d0526870008f13f86',
'5e739351451d8b0008f62c61',
'5e6fb53873842a00079aeaa6',
'5e753273cb48b200080de349',
'5e7399ff5398870007349a37',
'5e71348b43a76a0008a2c549',
'5ec4c12aa0a80f0008905de1',
'5ecd7e994b1d86000800164a',
'5ec54ecbff974f00082ae7b5',
'5ee139ab53bfb000077cd657',
'5edaabb16c01830008faa3c2',
'5ed81140dd99f200080c4339',
'5ee145daaaf8c6000707d107',
'5e1cdeffb520c400305a5d8a',
'5e1e1bc05c8b6900e7481dc8',
'5e1dd9dc84c43f002edb3f42',
'5e1f49f79e10a1030db19c7b',
'5e1e1474fd3be5002d7a6c93',
'5e1faad416f5e60079caf52c',
'5e1f3f1799db4c007f4172b6',
'5e20e7d142b60400ee31f694',
'5e1e863391d02701b41639d1',
'5e222bb163bb28059acf6402',
'5e20b67d40699a049b5a41aa',
'5e21dc71139624032b829755',
'5e20d08d17827e0030673acb',
'5e20d0a417827e0030673ba4',
'5ebc1407bc81920007347128',
'5ebd930f0bdecf0008ea09f6',
'5ebc54065ceb5a0008938c80',
'5ebf075679bfe700073cc2ff',
'5ebc474f222e840008aca5fa',
'5ebd9b78db902800089f07e2',
'5ef03cb975394e0007da0344',
'5defed47cb12b100a5e06af1',
'5deff3ccff3c1e0037b902a5',
'5df014eb74e353007976b032',
'5defe87bff3c1e0037b753fb',
'5df00cf04e325d002e096245',
'5df117575b0f9e00ce583b26',
'5df0211127b482008c77593f',
'5df14a3a3dd4f0002efbe164',
'5df114d3ca9bca0318cd55b5',
'5defcb4a2dbd7b003a24220e',
'5df01e5a8d637c00a2b2a58c',
'5df02b1cfe6d7a007934fa40',
'5d9e1135a8b1ce00325d13d6',
'5da0f14057a987073fdafdde',
'5da0f31a57a987073fdb0b38',
'5da48c492cb8a109c5d8580d',
'5da49f38194a1f094474770b',
'5da4e027448f941141d64b61',
'5da49cba87924d0a53ada3ed',
'5da4d223d331a70ab5813fd3',
'5da601ba0821bc181a4ea96d',
'5da4e1451c07110ed43289df',
'5da4b0ae12392609e0c35e45',
'5da4caae88be780e6e953c67',
'5da5ed570399730fe23ebc3b',
'5da5ee833c5b1f131125e14e',
'5ebeb3e24dd6d20007ad1f7d',
'5ebeb4c02e0fa0000713594d',
'5ebeb5354dd6d20007ad1f86',
'5ebeb5d24dd6d20007ad1f8b',
'5ebeb6934dd6d20007ad1f8f',
'5ebeb7032e0fa00007135950',
'5d8ce116105b3800c80ee76c',
'5d8d209c4e75e5017837616f',
'5d8ce15b86362c0095cbc1f6',
'5d8cfde401440e017806a9d7',
'5d769b818df2a0008c05659d',
'5d77c03a36801502739061bd',
'5d7811021b5eb70643e298f9',
'5d78145fd85ef106a35bc300',
'5e6911b49553d10007c42927',
'5e6aa5abc565340008a2bfeb',
'5e6fb1c84fed0100086b27c2',
'5e713202ad8f8d0008237fe7',
'5e6908b59553d10007c42911',
'5e6908949553d10007c42910',
'5e690bed9553d10007c42918',
'5e69090b9553d10007c42913',
'5e6be57fd98c5d0008fb7595') THEN 'Walker Segment'
ELSE 'Hiker Only Segment'
END as "Segment"
FROM unique_logs
left join prodmongo.workouts w on unique_logs.workout_id = w._id
--left join workout_store.workouts ws on unique_logs.workout_id = ws._id
left join prodmongo.programs__workouts pw on w._id = pw.workouts
join prodmongo.users on unique_logs.user_id = users._id
WHERE workout_id IN ('5e5447825c38e00008aae76f',
'5e55821ab42d120008a51c60',
'5e54375c5c38e00008aae71b',
'5e5457ef4c11ae00071ba70f',
'5e5442835c38e00008aae754',
'5e66847edaeab30009c04c09',
'5e589160ec549300080edb8d',
'5e61429d6562f70008f5e756',
'5e78e11d0526870008f13f86',
'5e739351451d8b0008f62c61',
'5e6fb53873842a00079aeaa6',
'5e753273cb48b200080de349',
'5e7399ff5398870007349a37',
'5e71348b43a76a0008a2c549',
'5ec4c12aa0a80f0008905de1',
'5ecd7e994b1d86000800164a',
'5ec54ecbff974f00082ae7b5',
'5ee139ab53bfb000077cd657',
'5edaabb16c01830008faa3c2',
'5ed81140dd99f200080c4339',
'5ee145daaaf8c6000707d107',
'5e1cdeffb520c400305a5d8a',
'5e1e1bc05c8b6900e7481dc8',
'5e1dd9dc84c43f002edb3f42',
'5e1f49f79e10a1030db19c7b',
'5e1e1474fd3be5002d7a6c93',
'5e1faad416f5e60079caf52c',
'5e1f3f1799db4c007f4172b6',
'5e20e7d142b60400ee31f694',
'5e1e863391d02701b41639d1',
'5e222bb163bb28059acf6402',
'5e20b67d40699a049b5a41aa',
'5e21dc71139624032b829755',
'5e20d08d17827e0030673acb',
'5e20d0a417827e0030673ba4',
'5ebc1407bc81920007347128',
'5ebd930f0bdecf0008ea09f6',
'5ebc54065ceb5a0008938c80',
'5ebf075679bfe700073cc2ff',
'5ebc474f222e840008aca5fa',
'5ebd9b78db902800089f07e2',
'5ef03cb975394e0007da0344',
'5defed47cb12b100a5e06af1',
'5deff3ccff3c1e0037b902a5',
'5df014eb74e353007976b032',
'5defe87bff3c1e0037b753fb',
'5df00cf04e325d002e096245',
'5df117575b0f9e00ce583b26',
'5df0211127b482008c77593f',
'5df14a3a3dd4f0002efbe164',
'5df114d3ca9bca0318cd55b5',
'5defcb4a2dbd7b003a24220e',
'5df01e5a8d637c00a2b2a58c',
'5df02b1cfe6d7a007934fa40',
'5d9e1135a8b1ce00325d13d6',
'5da0f14057a987073fdafdde',
'5da0f31a57a987073fdb0b38',
'5da48c492cb8a109c5d8580d',
'5da49f38194a1f094474770b',
'5da4e027448f941141d64b61',
'5da49cba87924d0a53ada3ed',
'5da4d223d331a70ab5813fd3',
'5da601ba0821bc181a4ea96d',
'5da4e1451c07110ed43289df',
'5da4b0ae12392609e0c35e45',
'5da4caae88be780e6e953c67',
'5da5ed570399730fe23ebc3b',
'5da5ee833c5b1f131125e14e',
'5ebeb3e24dd6d20007ad1f7d',
'5ebeb4c02e0fa0000713594d',
'5ebeb5354dd6d20007ad1f86',
'5ebeb5d24dd6d20007ad1f8b',
'5ebeb6934dd6d20007ad1f8f',
'5ebeb7032e0fa00007135950',
'5d8ce116105b3800c80ee76c',
'5d8d209c4e75e5017837616f',
'5d8ce15b86362c0095cbc1f6',
'5d8cfde401440e017806a9d7',
'5d769b818df2a0008c05659d',
'5d77c03a36801502739061bd',
'5d7811021b5eb70643e298f9',
'5d78145fd85ef106a35bc300',
'5e6911b49553d10007c42927',
'5e6aa5abc565340008a2bfeb',
'5e6fb1c84fed0100086b27c2',
'5e713202ad8f8d0008237fe7',
'5e6908b59553d10007c42911',
'5e6908949553d10007c42910',
'5e690bed9553d10007c42918',
'5e69090b9553d10007c42913',
'5e6be57fd98c5d0008fb7595',
'5e4f0a37be2b0000079c972d',
'5e4ee022b7469900083e59d4',
'5e4ee545b7469900083e59e8',
'5e4ee362b7469900083e59e0',
'5e41bcaf18675e0008f76982',
'5e41ef89a3e9ce0008a2f567',
'5e454bffc09d510008fc9c39',
'5e44628a845ad90007eae5fb',
'5e45702dd016cd0008a099a2',
'5e4326294a2caa0009104eb5',
'5e446533845ad90007eae605',
'5e4417e7e5e44400080fc38f',
'5e43146f07c42c000760d458',
'5e41779644ac0f0008a17de0',
'5e41713a8e1edf000701a41b',
'5e4317a807c42c000760d45b',
'5e4183458743400007dd072e',
'5e3d9b9a1780e2000728d896',
'5e271f9031bae400073d1f96',
'5e27137e16f2fc0009285a29',
'5e271de231bae400073d1f90',
'5e2789ea0f4d3200084677d5',
'5e1cc5659831140038e3cb31',
'5e20cd22d6c5aa008c1c210b',
'5e21c7251ff9ab02a4373493',
'5e21e4ef4d0ada024ff15933',
'5e21f22186c4bf036b4e1295',
'5e25d4ea32cb5e0035fb7f67',
'5e25db1463a8da01277814ce',
'5ca3e1d04e69810071682195',
'5ca4e888ceb5ca01dab8c20d',
'5ca4c99991ecf40145e215e7',
'5ca50f7ffe4cef0239676f5b',
'5ca6578d22752a01637d7362',
'5ea730dc7fd4b10008af5aa5',
'5eb2c9da0c472b0007d05759',
'5eb308324cfd7600081de1da',
'5ea7327987ae820007a0a4ca',
'5eb30d732bc29c0007c3fc19',
'5eb315ebbe2df50007d215e7',
'5eb99b0a405c2f00075e9c41',
'5ea7330eef5ef30007936fc9',
'5eb42b07d90ecc0007d8c812',
'5eb57c6d59244000089442da',
'5ca789a71874f401534cd791',
'5ca624da0152c0026099dc27',
'5ca634a20152c002609a2a73',
'5ca642f3da923201d04cccb8',
'5ca51f8a87ff55002a9e0314',
'5ca52812c83084002a223dc1',
'5ca621617fecee018431352c',
'5ca62efe9507f3024f33900f',
'5ca6379379f9e901439c3b11',
'5ca63f97ac3eb00293c5db61',
'5e84b57fda1b8f0007fa8b2e',
'5e7268d935f03a0007a7cbb9',
'5e837a3f5af1d00008380621',
'5e83699201d33e000798d6df',
'5e8394e44147d10007ba194e',
'5e738c510b3328000883a75b',
'5e84ba1ada1b8f0007fa8b35',
'5e861a98711ec3000833bf56',
'5e84c29e87405c00070b9172',
'5e84dec4a36017000815762a',
'5e86156009f9e50009c43dc6',
'5e84f63604d4260007fb7553',
'5e8244afa325240007d51b8c',
'5e87898ab7914a0009a1feb0',
'5e73913bfc93100007594c4f',
'5e86624957752200071d250c',
'5e876ce5f51e6f0007723c34',
'5e82196bcdc883000884c515',
'5e86346878ae7e000894afd5',
'5e87561d20b3e0000752ab1b',
'5d80fb48be4c720315ae0604',
'5d810e0fefc57f04d74616ec',
'5d813d7bb127ec03b119d3fd',
'5d813881faafbf0570af8724',
'5d83ad95212c3e0120fcea76',
'5d83ee1b0d7306020cbaf977',
'5d83c68ae1770901ae4df012',
'5d8568eeb7598301ba04a6dd',
'5d83f78360955702a781c73f',
'5d840aa797569d0311841ca9',
'5d8154839480b40639115583',
'5d85084e3854a6002f57a935',
'5d83b5e405cbfc0156699c26',
'5ec7e93546582c00078c9883',
'5ec7fd2c3fdec50007256644',
'5ec83e57a737b90008c98c4f',
'5ecd72281e13070009875556',
'5ec816312a998e0008db3744',
'5ec7f72e80ba0d0008b4e0ca',
'5eeb78c17616ed0008cc78d5')
)
WHERE percent_complete >= 0.7
GROUP BY 1,2,3
)
)
WHERE row_number = 1 AND segment <> 'Hiker Only Segment'
